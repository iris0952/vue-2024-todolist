import{p as Z,r as P,q as $,s as T,x as tt,y as p,z as B,A as et,B as st,C as nt,D as ot,E as ct,G as rt,H as ut,c as at}from"./index-DGiUeT1g.js";import{b as R,c as I,e as V}from"./cookieHandler-vFihtQH5.js";/*!
 * pinia v2.2.2
 * (c) 2024 Eduardo San Martin Morote
 * @license MIT
 */let J;const H=t=>J=t,ft=Symbol();function A(t){return t&&typeof t=="object"&&Object.prototype.toString.call(t)==="[object Object]"&&typeof t.toJSON!="function"}var O;(function(t){t.direct="direct",t.patchObject="patch object",t.patchFunction="patch function"})(O||(O={}));const K=()=>{};function q(t,o,s,e=K){t.push(o);const a=()=>{const f=t.indexOf(o);f>-1&&(t.splice(f,1),e())};return!s&&ot()&&ct(a),a}function C(t,...o){t.slice().forEach(s=>{s(...o)})}const lt=t=>t(),z=Symbol(),L=Symbol();function W(t,o){t instanceof Map&&o instanceof Map?o.forEach((s,e)=>t.set(e,s)):t instanceof Set&&o instanceof Set&&o.forEach(t.add,t);for(const s in o){if(!o.hasOwnProperty(s))continue;const e=o[s],a=t[s];A(a)&&A(e)&&t.hasOwnProperty(s)&&!p(e)&&!B(e)?t[s]=W(a,e):t[s]=e}return t}const it=Symbol();function ht(t){return!A(t)||!t.hasOwnProperty(it)}const{assign:b}=Object;function vt(t){return!!(p(t)&&t.effect)}function yt(t,o,s,e){const{state:a,actions:f,getters:r}=o,u=s.state.value[t];let S;function h(){u||(s.state.value[t]=a?a():{});const y=rt(s.state.value[t]);return b(y,f,Object.keys(r||{}).reduce((m,d)=>(m[d]=ut(at(()=>{H(s);const k=s._s.get(t);return r[d].call(k,k)})),m),{}))}return S=M(t,h,o,s,e,!0),S}function M(t,o,s={},e,a,f){let r;const u=b({actions:{}},s),S={deep:!0};let h,y,m=[],d=[],k;const g=e.state.value[t];!f&&!g&&(e.state.value[t]={}),P({});let N;function F(c){let n;h=y=!1,typeof c=="function"?(c(e.state.value[t]),n={type:O.patchFunction,storeId:t,events:k}):(W(e.state.value[t],c),n={type:O.patchObject,payload:c,storeId:t,events:k});const l=N=Symbol();nt().then(()=>{N===l&&(h=!0)}),y=!0,C(m,n,e.state.value[t])}const G=f?function(){const{state:n}=s,l=n?n():{};this.$patch(j=>{b(j,l)})}:K;function Q(){r.stop(),m=[],d=[],e._s.delete(t)}const D=(c,n="")=>{if(z in c)return c[L]=n,c;const l=function(){H(e);const j=Array.from(arguments),w=[],E=[];function X(i){w.push(i)}function Y(i){E.push(i)}C(d,{args:j,name:l[L],store:v,after:X,onError:Y});let x;try{x=c.apply(this&&this.$id===t?this:v,j)}catch(i){throw C(E,i),i}return x instanceof Promise?x.then(i=>(C(w,i),i)).catch(i=>(C(E,i),Promise.reject(i))):(C(w,x),x)};return l[z]=!0,l[L]=n,l},U={_p:e,$id:t,$onAction:q.bind(null,d),$patch:F,$reset:G,$subscribe(c,n={}){const l=q(m,c,n.detached,()=>j()),j=r.run(()=>$(()=>e.state.value[t],w=>{(n.flush==="sync"?y:h)&&c({storeId:t,type:O.direct,events:k},w)},b({},S,n)));return l},$dispose:Q},v=T(U);e._s.set(t,v);const _=(e._a&&e._a.runWithContext||lt)(()=>e._e.run(()=>(r=tt()).run(()=>o({action:D}))));for(const c in _){const n=_[c];if(p(n)&&!vt(n)||B(n))f||(g&&ht(n)&&(p(n)?n.value=g[c]:W(n,g[c])),e.state.value[t][c]=n);else if(typeof n=="function"){const l=D(n,c);_[c]=l,u.actions[c]=n}}return b(v,_),b(et(v),_),Object.defineProperty(v,"$state",{get:()=>e.state.value[t],set:c=>{F(n=>{b(n,c)})}}),e._p.forEach(c=>{b(v,r.run(()=>c({store:v,app:e._a,pinia:e,options:u})))}),g&&f&&s.hydrate&&s.hydrate(v.$state,g),h=!0,y=!0,v}function bt(t,o,s){let e,a;const f=typeof o=="function";e=t,a=f?s:o;function r(u,S){const h=st();return u=u||(h?Z(ft,null):null),u&&H(u),u=J,u._s.has(e)||(f?M(e,o,a,u):yt(e,a,u)),u._s.get(e)}return r.$id=e,r}const kt=bt("auth",()=>{const t=P(!1),o=P(),s=P();async function e(r){const{data:u}=await R.users.login(r),{nickname:S,token:h,exp:y}=u;I.set(h,y),t.value=!0,o.value=S}async function a(){try{await R.users.logout(s.value),t.value=!1,I.delete()}catch(r){V(r)}}async function f(){try{const r=I.get();if(!r)return;s.value=r;const{data:u}=await R.users.checkAuth(s.value);o.value=u.nickname,t.value=!0}catch(r){t.value=!1,V(r)}}return{status:t,user:o,token:s,login:e,logout:a,authCheck:f}});export{kt as u};
